## ã€Šä»é›¶å®ç° KV å­˜å‚¨ã€‹è¯¾ç¨‹å·²ä¸Šçº¿ï¼

ä½¿ç”¨ Rust å’Œ Go æ„å»ºä¸€ä¸ªå®Œæ•´çš„ï¼Œæ”¯æŒ Redis åè®®çš„ KV å­˜å‚¨å¼•æ“ï¼Œç¡¬æ ¸é¡¹ç›®å®æˆ˜ï¼

è¯¾ç¨‹è¯¦æƒ…ï¼š[ä½¿ç”¨ Rust å’Œ Go ä»é›¶å®ç° KV å­˜å‚¨](https://w02agegxg3.feishu.cn/docx/Ktp3dBGl9oHdbOxbjUWcGdSnn3g)

***

## ã€Šä»é›¶å®ç°åˆ†å¸ƒå¼ KVã€‹è¯¾ç¨‹å·²ä¸Šçº¿ï¼

æ‰‹å†™ raft + åˆ†å¸ƒå¼ KV ç³»ç»Ÿï¼Œç¡¬æ ¸å®æˆ˜æ•™ç¨‹ï¼Œæ·±å…¥ç†è§£åˆ†å¸ƒå¼ç†è®ºå’Œå®è·µå¿…å¤‡ï¼

è¯¾ç¨‹è¯¦æƒ…ï¼š[ä»é›¶å®ç°åˆ†å¸ƒå¼ KV](https://av6huf2e1k.feishu.cn/docx/JCssdlgF4oRADcxxLqncPpRCn5b)

***

**ä¸‹æ–‡ä¸­æåˆ°çš„å­¦ä¹ èµ„æ–™ PDF åŠæ•°æ®åº“ç›¸å…³ä¹¦ç±ï¼Œå¯åœ¨æˆ‘å…¬ä¼—å·é¢†å–**ï¼Œå…³æ³¨åå›å¤å…³é”®å­—â€œ**æ•°æ®åº“**â€

![Snipaste_2023-02-01_09-58-05.png](https://cdn.nlark.com/yuque/0/2023/png/12925940/1675216713682-a3cab6f7-93ca-4699-999d-223ba77cbc97.png?x-oss-process=image%2Fresize%2Cw_1500%2Climit_0)

***

# æ•°æ®åº“/å­˜å‚¨å­¦ä¹ è·¯å¾„æ¨è

æˆ‘è‡ªå·±å°±æ˜¯ä»ä¸šåŠ¡è‡ªå­¦è½¬å…¥æ•°æ®åº“å†…æ ¸ç ”å‘å²—ä½çš„ï¼Œæ ¹æ®è‡ªå·±çš„ç»å†ï¼Œç®€å•æ€»ç»“äº†ä¸€ä¸‹å…¥é—¨æ•°æ®åº“/å­˜å‚¨ç›¸å…³çš„å­¦ä¹ è·¯çº¿ã€å­¦ä¹ èµ„æ–™ã€é¡¹ç›®ä¹¦ç±æ¨èç­‰ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒã€‚
## å¿…çœ‹è¯¾ç¨‹
CMU-15445 å’Œ CMU-15721
[https://www.youtube.com/@CMUDatabaseGroup](https://www.youtube.com/@CMUDatabaseGroup)
è¿™ä¸¤ä¸ªä¸ç”¨å¤šè¯´ï¼Œç»å…¸çš„æ•°æ®åº“å…¥é—¨æ•™ç¨‹ï¼Œç”±æ•°æ®åº“çš„å¤§ä½¬ Andy Pavlo äº²è‡ªæˆè¯¾ã€‚å¯ä»¥äº†è§£åˆ°æ•°æ®åº“çš„åŸºæœ¬æ¦‚å¿µï¼Œä¾‹å¦‚å­˜å‚¨ã€BufferPool ç¼“å†²æ± ã€ç´¢å¼•ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ã€äº‹åŠ¡ç­‰ã€‚

15445 çš„å®éªŒéƒ¨åˆ†æ˜¯åŸºäºå…¶å¼€æºçš„æ•™å­¦é¡¹ç›® [bustub](https://github.com/cmu-db/bustub)ï¼Œè¡¥å…¨å…¶ä¸­å‡ ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯ C++ å†™çš„ï¼Œå¦‚æœå¯¹ C++ ä¸ç†Ÿæ‚‰çš„è¯ï¼Œé‚£ä¹ˆæˆ‘è§‰å¾—å®éªŒéƒ¨åˆ†å¯ä»¥æš‚æ—¶è·³è¿‡ï¼Œæœ‰å¤šä½™çš„ç²¾åŠ›å†æ¥æï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯æ¥å­¦æ•°æ®åº“çš„ï¼Œè€Œä¸æ˜¯å­¦ C++ çš„ã€‚
## å­˜å‚¨é¡¹ç›®å®è·µ
å­¦ä¹ æ•°æ®åº“è¯¾ç¨‹çš„åŒæ—¶ï¼Œé¡ºä¾¿å¯ä»¥äº†è§£ä¸‹å­˜å‚¨æ–¹é¢çš„å†…å®¹ï¼Œå­˜å‚¨æ˜¯æ•°æ®åº“å¿…ä¸å¯ç¼ºçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚
ä¾‹å¦‚ B+ æ ‘ã€bitcaskã€LSM Treeï¼Œä»¥åŠ LSM Tree çš„ä¼˜åŒ– Wisckeyï¼Œæ‰¾å‡ ç¯‡æ–‡ç« çœ‹çœ‹ï¼Œäº†è§£ä¸‹åŸºæœ¬æ¦‚å¿µï¼Œæˆ–è€…ç›´æ¥çœ‹çœ‹å¯¹åº”çš„æœ€æƒå¨çš„è®ºæ–‡ã€‚

ç„¶åè‡ªå·±å»å®è·µå†™ä¸€ä¸ªï¼Œä¾‹å¦‚å†™ä¸€ä¸ªç®€å•çš„ bitcaskã€B+ æ ‘å­˜å‚¨å¼•æ“ï¼Œæˆ–è€… LSM å­˜å‚¨å¼•æ“ã€‚
åœ¨æˆ‘çš„ç»éªŒçœ‹æ¥ï¼Œè¿™å‡ ç±»å­˜å‚¨å¼•æ“ï¼Œå®ç°çš„éš¾åº¦å¤§è‡´æ˜¯ B+æ ‘ >= LSM > bitcaskï¼Œbitcask å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ LSM Treeã€‚
å¯¹äº B+ æ ‘ï¼Œå­¦ä¹ çš„èµ„æ–™æœ‰

- [BoltDB](https://github.com/etcd-io/bbolt)ï¼ŒGo è¯­è¨€å†™çš„ä¸€ä¸ª B+ æ ‘å•æœºå­˜å‚¨å¼•æ“ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¹¿æ³›åº”ç”¨
- [https://cstack.github.io/db_tutorial](https://cstack.github.io/db_tutorial/)ï¼Œä¸€ä¸ªç®€å•çš„ä»é›¶å¼€å§‹å†™æ•°æ®åº“çš„æ•™ç¨‹ï¼Œç±»ä¼¼ SQLiteï¼ŒC è¯­è¨€å®ç°

LSM Treeï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹èµ„æ–™

- [leveldb](https://github.com/google/leveldb)ï¼ŒGoogle å¼€æºçš„å•æœºå­˜å‚¨å¼•æ“ï¼ŒGo è¯­è¨€ä¹Ÿæœ‰ä¸€ä¸ªå¯¹åº”çš„å®ç° [goleveldb](https://github.com/syndtr/goleveldb)
- [leveldb-rs](https://github.com/dermesser/leveldb-rs)ï¼ŒRust å®ç°çš„ leveldb
- [mini-lsm](https://github.com/skyzh/mini-lsm)ï¼Œä¸€ä¸ªä»é›¶å®ç°æç®€çš„ LSM æ•™ç¨‹ï¼ŒRust å®ç°

bitcask å¯å‚è€ƒèµ„æ–™ï¼š

- [rosedb](https://github.com/rosedblabs/rosedb)ï¼ŒåŸºäº bitcask çš„å•æœº KV å¼•æ“
- [mini-bitcask](https://github.com/rosedblabs/mini-bitcask)ï¼Œä¸€ä¸ªæç®€çš„ bitcask æ•™ç¨‹

ä¹‹æ‰€ä»¥æ¨èå†™å­˜å‚¨ç±»çš„å°é¡¹ç›®ï¼Œä¸»è¦æ˜¯å› ä¸ºå­˜å‚¨å±‚çš„ KV ä¸€èˆ¬æ¯”è¾ƒå¥½å®ç°ï¼ŒåŒæ—¶åˆèƒ½å¤Ÿäº†è§£åˆ°ä¸€äº›æ•°æ®åº“çš„åŸºæœ¬è®¾è®¡ç†å¿µã€‚
**å¼ºçƒˆæ¨èğŸ‘ğŸ»**
å¦‚æœæƒ³è¦ä¸€ä¸ªå®Œæ•´å®ç° KV å­˜å‚¨çš„ä»£ç å®è·µæ•™ç¨‹ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„[ã€Šä»é›¶å®ç° KV å­˜å‚¨ã€‹](https://w02agegxg3.feishu.cn/docx/Ktp3dBGl9oHdbOxbjUWcGdSnn3g)çš„æ•™ç¨‹ï¼Œä»ç¬¬ä¸€è¡Œä»£ç å¼€å§‹çš„è§†é¢‘å®æˆ˜æ•™ç¨‹ï¼Œä½¿ç”¨ Go å’Œ Rust ä¸¤ç§è¯­è¨€åˆ†åˆ«å®ç°ã€‚
## äº‹åŠ¡/MVCC
è¿™éƒ¨åˆ†ç½‘ä¸Šçš„èµ„æ–™æ¯”è¾ƒå¤šï¼Œå¯ä»¥çœ‹çœ‹äº‹åŠ¡çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ ACIDï¼Œç„¶åçœ‹çœ‹å¦‚ä½•å»å®ç°çš„ï¼Œå¯ä»¥å€Ÿé‰´å…¶ä»–æ•°æ®åº“ä¾‹å¦‚ MySQLã€PostgreSQLï¼Œå…³äºäº‹åŠ¡å®ç°åŸç†åˆ†æè¿™æ–¹é¢çš„æ–‡ç« æ¯”è¾ƒå¤šã€‚

æ¦‚å¿µäº†è§£å·®ä¸å¤šä¹‹åï¼Œå¯ä»¥è‡ªå·±åŠ¨æ‰‹å®ç°ï¼Œä¾‹å¦‚å¯ä»¥åœ¨è‡ªå·±å†™çš„å­˜å‚¨é¡¹ç›®çš„åŸºç¡€ä¸Šï¼ŒåŠ ä¸Šäº‹åŠ¡çš„åŠŸèƒ½ï¼Œä¿è¯äº‹åŠ¡åŸå­æ€§ã€éš”ç¦»æ€§ï¼Œä»¥åŠå¹¶å‘è¯»å†™çš„æ€§èƒ½ï¼Œè‡ªå·±ä¸Šæ‰‹æ’¸è‚¯å®šæ¯”åªäº†è§£ç†è®ºå¥½å¾ˆå¤šã€‚
CMU 15445 å’Œ 15721 è¯¾ç¨‹éƒ½è®²åˆ°äº†äº‹åŠ¡çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œå¯ä»¥å‚è€ƒ [https://15445.courses.cs.cmu.edu/fall2019/schedule.html#oct-23-2019](https://15445.courses.cs.cmu.edu/fall2019/schedule.html#oct-23-2019)

å…¶ä»–çš„ä¸€äº›éƒ¨åˆ†ï¼Œä¾‹å¦‚ parserã€æ‰§è¡Œå™¨ã€ä¼˜åŒ–å™¨ã€å‘é‡åŒ–ç­‰ç­‰ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œè‡ªå·±ä»å¤´æä¸€ä¸ªçš„éš¾åº¦æ¯”è¾ƒå¤§ï¼Œæˆ‘è§‰å¾—å¯ä»¥ç®€å•çœ‹çœ‹èµ„æ–™ï¼Œäº†è§£ä¸€ä¸‹åŸºæœ¬æ¦‚å¿µï¼Œå·¥ä½œä¹‹ä¸­å†é’ˆå¯¹æ€§çš„æŸ¥æ¼è¡¥ç¼ºã€‚

å½“ç„¶å¦‚æœä½ å¯¹æŸä¸ªéƒ¨åˆ†ç‰¹åˆ«æ„Ÿå…´è¶£çš„è¯ï¼Œæ¯”å¦‚ä¼˜åŒ–å™¨ä¹‹ç±»çš„ï¼Œä¹Ÿå¯ä»¥å¤šå»äº†è§£ç„¶åè‡ªå·±å®è·µï¼Œæˆ‘è¿™é‡Œæ¨èå­˜å‚¨å’Œäº‹åŠ¡çš„å®ç°ï¼Œæ˜¯å› ä¸ºç›¸å¯¹æ¥è¯´æ¯”è¾ƒå®¹æ˜“ä¸Šæ‰‹ã€‚

å…¶ä»–æ–¹é¢çš„é¡¹ç›®å®è·µè¿™é‡Œä¹Ÿæ¨èä¸€äº›èµ„æ–™ï¼š

- Go è¯­è¨€å®ç°çš„ sql è§£æå™¨ [https://github.com/xwb1989/sqlparser](https://github.com/xwb1989/sqlparser)
- TiDB çš„ mysql è§£æå™¨ [https://github.com/pingcap/tidb/tree/master/pkg/parser](https://github.com/pingcap/tidb/tree/master/pkg/parser)
- Rust å®ç°çš„ sql parser [https://github.com/sqlparser-rs/sqlparser-rs](https://github.com/sqlparser-rs/sqlparser-rs)
- Meta å¼€æºç»´æŠ¤çš„é€šç”¨æ•°æ®åº“æ‰§è¡Œæ¡†æ¶ Velox [https://github.com/facebookincubator/velox](https://github.com/facebookincubator/velox)
- å‘é‡åŒ–æ‰§è¡Œæ¡†æ¶ Arrow [https://github.com/apache/arrow](https://github.com/apache/arrow)
## åˆ†å¸ƒå¼
è¿™éƒ¨åˆ†å†…å®¹é¦–æ¨ MIT 6824ï¼ˆç°å·²æ”¹åä¸º 6.5840ï¼‰ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå…¥é—¨çš„é¦–é€‰è¯¾ç¨‹ã€‚
[https://www.youtube.com/@6.824/videos](https://www.youtube.com/@6.824/videos)
æœ‰ç²¾åŠ›çš„è¯å¯ä»¥è·Ÿç€æŠŠå®éªŒéƒ¨åˆ†åšå®Œã€‚lab æ˜¯å®ç°ä¸€ä¸ªé™¤æˆå‘˜å˜æ›´ä¹‹å¤–çš„ raft å…±è¯†ç®—æ³•ï¼Œå¹¶ä¸”åŸºäº raft å®ç°ä¸€ä¸ªå®¹é”™çš„åˆ†å¸ƒå¼ KV ç³»ç»Ÿã€‚
**å¼ºçƒˆæ¨èğŸ‘ğŸ»**
å¦‚æœå¯¹è¯¾ç¨‹å†…å®¹å¹¶ä¸ç†Ÿæ‚‰çš„è¯ï¼Œåˆæ¬¡ä¸Šæ‰‹åš lab å¯èƒ½ä¼šæ¯”è¾ƒç—›è‹¦ï¼Œå¹¶ä¸”è‡ªå·±æä¹Ÿå¯èƒ½ä¼šæ¯”è¾ƒæµªè´¹æ—¶é—´ã€‚
å¯ä»¥çœ‹çœ‹æˆ‘çš„[ã€Šä»é›¶å®ç°åˆ†å¸ƒå¼ KVã€‹](https://av6huf2e1k.feishu.cn/docx/JCssdlgF4oRADcxxLqncPpRCn5b)æ•™ç¨‹ï¼Œä»é›¶å¼€å§‹ï¼ŒåŸºäº 6824 çš„ labï¼Œå†™ä¸€ä¸ªåŸºäº raft çš„åˆ†å¸ƒå¼ KVï¼Œæ•™ç¨‹å†…å®¹å®Œå…¨æ¶µç›–äº† 6824 çš„ lab éƒ¨åˆ†ã€‚

è¿™ä¸ªå­¦å®Œäº†ä¹‹åï¼Œå¯ä»¥æŒ‘æˆ˜ä¸‹ PingCAP çš„ talent plan ä¸­çš„ TinyKVï¼Œå®ƒå’Œ 6824 çš„å®éªŒéƒ¨åˆ†æ¯”è¾ƒç±»ä¼¼ï¼Œå®ç°ä¸€ä¸ªåŸºäº raft çš„åˆ†å¸ƒå¼ KV å­˜å‚¨ç³»ç»Ÿï¼Œéš¾åº¦ä¼šæ¯” 6824 æ›´å¤§ï¼Œlab çš„ä»£ç æ¡†æ¶æ˜¯ç°æˆçš„ï¼Œåªéœ€è¦å¾€é‡Œé¢æ·»åŠ å†…å®¹å³å¯ï¼Œæµ‹è¯•ä¹Ÿæ¯”è¾ƒå®Œå¤‡ã€‚
[https://github.com/talent-plan/tinykv](https://github.com/talent-plan/tinykv)

å¦‚æœè¿˜æœ‰æ—¶é—´çš„è¯ï¼Œå¯ä»¥å†ä¸Šä¸€ä¸ªå°é˜¶ï¼ŒæŒ‘æˆ˜ä¸‹ PingCAP talent plan çš„ TinySQL é¡¹ç›®ï¼Œä¸»è¦æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒå¼æ•°æ®åº“é¡¹ç›®ï¼Œæœ‰å®Œå¤‡çš„æ–‡å­—æ•™ç¨‹ï¼Œåªæ˜¯éš¾åº¦ç•¥å¤§ã€‚
[https://github.com/talent-plan/tinysql](https://github.com/talent-plan/tinysql)
## å·¥ä½œæˆ–è€…å®ä¹ 
å½“ç„¶ï¼Œå…¶å®æœ€å¥½çš„åŠæ³•ï¼Œè¿˜æ˜¯èƒ½å¤Ÿç›´æ¥å‚ä¸åˆ°å·¥ä½œå®è·µå½“ä¸­ï¼Œè¿™æ ·å­¦ä¹ èµ·æ¥æ˜¯æœ€å¿«çš„ï¼Œå¯ä»¥å‘ leader è¯·æ•™ï¼Œå’ŒåŒäº‹äº¤æµç­‰ã€‚

å¦‚æœè‡ªèº«åˆæ²¡æœ‰å¤ªå¤šç»éªŒçš„è¯ï¼Œå¯ä»¥è¯•è¯•é‚£äº›æ„¿æ„æ¥çº³è½¬æ•°æ®åº“å†…æ ¸çš„å…¬å¸ï¼Œè¿™å¯èƒ½ä¼šè¦æ±‚ä½ æœ‰å…¶ä»–äº®çœ¼çš„ä¸œè¥¿äº†ï¼Œæ¯”å¦‚åŸºç¡€æ¯”è¾ƒæ‰å®ï¼ŒæŠ˜è…¾è¿‡è‡ªå·±çš„é¡¹ç›®ä¹‹ç±»çš„ã€‚èƒ½æŠŠä¸Šé¢æåˆ°çš„è¿™äº›ä¸œè¥¿è®¤çœŸå­¦ä¹ ä¸‹ï¼Œå®Œæˆä¸ª 60% å·¦å³ï¼Œæˆ‘è§‰å¾—åº”å¯¹ä¸€äº›é¢è¯•å°±åº”è¯¥æ²¡æœ‰å¤ªå¤§çš„é—®é¢˜äº†ã€‚

---

ä¸ºäº†å¸®åŠ©ä½ æ›´é«˜æ•ˆçš„å­¦ä¹ ï¼Œæˆ‘è¿˜æ•´ç†äº†ä¸€ä»½æ•°æ®åº“å¼€å‘çš„å­¦ä¹ èµ„æ–™ï¼Œæ•°æ®åº“çš„å„ä¸ªæ–¹é¢éƒ½æ¶‰åŠåˆ°äº†ï¼Œä¾‹å¦‚ SQLã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå¼•æ“ã€å­˜å‚¨ç­‰ç­‰ï¼ŒåŒ…å«ä¸€äº›ä¼˜è´¨çš„ä¹¦ç±ã€è®ºæ–‡ã€è§†é¢‘è¯¾ç¨‹ã€åšå®¢ç­‰ï¼Œè¿˜æœ‰ä¸€äº›ä¼˜è´¨çš„æ•™å­¦ç±»é¡¹ç›®ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2023/png/12925940/1673770833130-d80eaccc-6fce-4e23-bdc5-5b00d1bb384f.png#averageHue=%23ececec&clientId=ufa50e856-2120-4&from=paste&height=746&id=ua30dabf1&originHeight=1492&originWidth=1700&originalType=binary&ratio=1&rotation=0&showTitle=false&size=296215&status=done&style=none&taskId=u7b00b1aa-bd87-48b7-934f-e9ca536db81&title=&width=850)
æ€»è®¡åå‡ é¡µçš„ PDFï¼Œä¸€æ¬¡æ€§é€ç»™ä½ ï¼Œæ–¹ä¾¿æå‡å­¦ä¹ æ•ˆç‡ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2023/png/12925940/1673770714528-fc5cd43d-54c6-4c7f-8c8a-b0e8106fdf3e.png#averageHue=%23f7f7f7&clientId=ufa50e856-2120-4&from=paste&height=615&id=uf81c3cca&originHeight=1230&originWidth=1294&originalType=binary&ratio=1&rotation=0&showTitle=false&size=321082&status=done&style=none&taskId=uca8d9770-71df-4791-9af6-a3cdad4d763&title=&width=647)
è¿˜æœ‰ä¸€äº›å…³äºæ•°æ®åº“æ–¹é¢çš„ä¼˜è´¨ PDF ä¹¦ç±ï¼Œå¯ä»¥å‚è€ƒå­¦ä¹ ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2023/png/12925940/1675175402743-f5987338-d67e-4c0d-a574-9c1a7f743ca0.png#averageHue=%23dbd8cf&clientId=u6861054c-f8dc-4&from=paste&height=451&id=u4b53b520&originHeight=902&originWidth=1682&originalType=binary&ratio=1&rotation=0&showTitle=false&size=897755&status=done&style=none&taskId=u6b44cf46-3c87-4c40-be5f-d7d56162dc1&title=&width=841)
è¿™ä»½å­¦ä¹ èµ„æ–™ PDF å’Œæ‰€æœ‰çš„ä¹¦ç±éƒ½å¯ä»¥åœ¨æˆ‘çš„å…¬ä¼—å·é¢†å–ï¼Œåå°å›å¤å…³é”®å­—**ã€æ•°æ®åº“ã€‘**ã€‚
![Snipaste_2023-02-01_09-58-05.png](https://cdn.nlark.com/yuque/0/2023/png/12925940/1675216713682-a3cab6f7-93ca-4699-999d-223ba77cbc97.png#averageHue=%23e9e6dc&clientId=u90c0e997-1881-4&from=ui&id=u6f9b9cd5&originHeight=762&originWidth=2800&originalType=binary&ratio=1&rotation=0&showTitle=false&size=260276&status=done&style=none&taskId=u07df7cea-d948-4f48-9257-7cc34779e12&title=)
